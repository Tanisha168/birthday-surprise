<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday üíñ</title>
  <style>
    :root{
      --bg1:#FFF5FB;
      --bg2:#FFF0F7;
      --accent:#ff6fb5;
      --accent2:#b97bff;
      --text:#2b1432;
      --soft:#f9eef6;
    }
    html,body{height:100%;margin:0;font-family: 'Helvetica Neue', Arial, sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--text);}
    .container{height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;position:relative;overflow:hidden;padding:20px;box-sizing:border-box;}
    /* pulsing tap card */
    .tap-card{
      width:320px;
      max-width:90%;
      height:180px;
      border-radius:22px;
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,250,255,0.8));
      box-shadow: 0 10px 30px rgba(180,80,140,0.15), inset 0 1px 0 rgba(255,255,255,0.6);
      display:flex;align-items:center;justify-content:center;flex-direction:column;
      transform-origin:center; cursor:pointer;
      transition:transform .25s ease, opacity .4s ease;
      text-align:center;
    }
    .tap-card:active{transform:scale(.98)}
    .pulse {
      width:90%;
      height:56px;
      border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      font-size:18px;
      font-weight:700;
      letter-spacing:.2px;
      color:white;
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      box-shadow: 0 6px 22px rgba(185,90,155,0.18);
      animation: pulseShadow 1.8s infinite;
    }
    @keyframes pulseShadow{
      0%{transform:translateY(0) scale(1);box-shadow:0 6px 18px rgba(185,90,155,0.18)}
      50%{transform:translateY(-6px) scale(1.02);box-shadow:0 18px 40px rgba(185,90,155,0.20)}
      100%{transform:translateY(0) scale(1);box-shadow:0 6px 18px rgba(185,90,155,0.18)}
    }

    /* Hidden main stage */
    .stage{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;opacity:0;pointer-events:none;transition:opacity .6s ease;}
    .stage.visible{opacity:1;pointer-events:auto;}
    .scene{
      width:720px;max-width:96%;min-height:420px;border-radius:18px;padding:28px;box-sizing:border-box;
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,245,250,0.8));
      box-shadow:0 20px 60px rgba(120,60,100,0.12);
      display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:18px;position:relative;overflow:visible;
    }

    /* cake area */
    .cake-wrap{width:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;}
    .greeting{font-size:28px;font-weight:800;color:var(--accent);text-shadow:0 6px 18px rgba(185,90,155,0.08);letter-spacing:.6px;}
    /* simple SVG cake holder */
    .cake{
      width:260px;height:220px;position:relative;display:block;
    }
    .candles .flame{filter:drop-shadow(0 6px 8px rgba(255,160,80,0.18));}
    .candle-flicker{animation: candleFlicker 1.2s infinite;}
    @keyframes candleFlicker{
      0%{transform:translateY(0) scaleY(1)}
      50%{transform:translateY(-2px) scaleY(1.02)}
      100%{transform:translateY(0) scaleY(1)}
    }

    /* confetti canvas */
    canvas.confetti{position:absolute;inset:0;pointer-events:none;z-index:8;}

    /* letter card */
    .letter{
      width:92%;max-width:680px;border-radius:14px;padding:18px 20px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,250,255,0.85));
      box-shadow: 0 10px 30px rgba(120,70,120,0.06);border:1px solid rgba(200,150,180,0.12);
      font-size:16px;color:#3a1430;line-height:1.55;display:none;position:relative;overflow:hidden;
    }
    .letter.visible{display:block;animation: fadeUp .8s ease both;}
    @keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:none}}

    .letter .title{font-weight:800;font-size:20px;margin-bottom:8px;color:var(--accent2)}
    .typed{white-space:pre-wrap;min-height:62px;letter-spacing:.2px}

    /* hearts */
    .hearts{position:absolute;inset:0;pointer-events:none;z-index:5;overflow:visible}
    .heart{position:absolute;width:18px;height:18px;transform:translate(-50%,-50%) rotate(-25deg);opacity:.9}
    .heart:before,.heart:after{content:"";position:absolute;width:12px;height:18px;background:linear-gradient(180deg,var(--accent),var(--accent2));border-radius:9px 9px 0 0;left:3px;top:0;}
    .heart:after{transform: rotate(90deg);left:0;top:0}
    /* little footer */
    .footer{font-size:12px;color:#804a71;margin-top:8px;opacity:.9}
    /* small responsive */
    @media (max-width:420px){
      .greeting{font-size:22px}
      .tap-card{height:150px}
      .pulse{height:48px;font-size:16px}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- initial tap card -->
    <div id="tapCard" class="tap-card" aria-label="Tap for surprise">
      <div style="transform:translateY(-8px)"><svg width="72" height="72" viewBox="0 0 24 24" fill="none" aria-hidden>
        <circle cx="12" cy="12" r="10" fill="rgba(255,240,250,0.9)"/>
        <path d="M12 7c1.657 0 3 1.567 3 3.5S13.657 14 12 14s-3-1.567-3-3.5S10.343 7 12 7z" fill="#ff6fb5"/>
      </svg></div>
      <div class="pulse">Tap here for your surprise üíù</div>
      <div style="font-size:13px;margin-top:12px;color:#6b3b57">(Hearts & cake inside ‚Äî Tap once)</div>
    </div>

    <!-- main stage -->
    <div id="stage" class="stage">
      <div class="scene" role="main" aria-live="polite">
        <div class="cake-wrap">
          <div class="greeting" id="greetingText">Happy Birthday, Baby üíñ</div>

          <!-- SVG cake -->
          <div class="cake" id="cake" aria-hidden>
            <!-- SVG drawn cake with candles -->
            <svg viewBox="0 0 300 260" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
              <!-- plate -->
              <ellipse cx="150" cy="210" rx="100" ry="20" fill="#fff6fb" stroke="#f4dff0" stroke-width="2"/>
              <!-- bottom layer -->
              <rect x="60" y="120" width="180" height="70" rx="18" fill="#ffd7ee" stroke="#f3b7de" stroke-width="2"/>
              <!-- frosting -->
              <path d="M60 120c20 16 20 12 50 10s60-14 90-6 20-10 30-10v20H60z" fill="#fff" opacity="0.95"/>
              <!-- top layer -->
              <rect x="90" y="80" width="120" height="50" rx="16" fill="#ff9ad1" stroke="#f3b7de" stroke-width="2"/>
              <!-- candle group -->
              <g class="candles" transform="translate(0,0)">
                <!-- 3 candles -->
                <g transform="translate(120,62)">
                  <rect x="-6" y="-30" width="12" height="30" rx="2" fill="#ffe7f3"/>
                  <rect x="-4" y="-28" width="8" height="26" rx="1.5" fill="#ff6fb5"/>
                  <g class="flame candle-flicker" transform="translate(0,-38)">
                    <path d="M0 0 C4 -4 8 -4 8 -8 C8 -12 4 -14 0 -10 C-4 -14 -8 -12 -8 -8 C-8 -4 -4 -4 0 0z" fill="#ffd480"/>
                  </g>
                </g>
                <g transform="translate(150,62)">
                  <rect x="-6" y="-30" width="12" height="30" rx="2" fill="#ffe7f3"/>
                  <rect x="-4" y="-28" width="8" height="26" rx="1.5" fill="#ffd07a"/>
                  <g class="flame candle-flicker" transform="translate(0,-38)">
                    <path d="M0 0 C4 -4 8 -4 8 -8 C8 -12 4 -14 0 -10 C-4 -14 -8 -12 -8 -8 C-8 -4 -4 -4 0 0z" fill="#ffd480"/>
                  </g>
                </g>
                <g transform="translate(180,62)">
                  <rect x="-6" y="-30" width="12" height="30" rx="2" fill="#ffe7f3"/>
                  <rect x="-4" y="-28" width="8" height="26" rx="1.5" fill="#b97bff"/>
                  <g class="flame candle-flicker" transform="translate(0,-38)">
                    <path d="M0 0 C4 -4 8 -4 8 -8 C8 -12 4 -14 0 -10 C-4 -14 -8 -12 -8 -8 C-8 -4 -4 -4 0 0z" fill="#ffd480"/>
                  </g>
                </g>
              </g>

              <!-- sprinkles -->
              <g>
                <circle cx="120" cy="150" r="3" fill="#fff2f7"/>
                <circle cx="160" cy="140" r="3" fill="#fff2f7"/>
                <circle cx="130" cy="170" r="3" fill="#fff2f7"/>
              </g>
            </svg>
          </div>
        </div>

        <!-- letter -->
        <div id="letter" class="letter" role="region" aria-label="Birthday letter">
          <div class="title">A note for you</div>
          <div class="typed" id="typedText"></div>
        </div>

        <div class="footer">‚Äî with all my love, Tanisha üíå</div>
      </div>

      <!-- hearts layer -->
      <div class="hearts" id="heartsContainer" aria-hidden></div>

      <!-- confetti canvas -->
      <canvas id="confettiCanvas" class="confetti"></canvas>
    </div>
  </div>

  <script>
    /*************** USER MESSAGE (edited/polished) ***************/
    const letterText = `Happy Birthday, Baby üíñ
I love you ‚Äî always and forever. üíå

This is your 26th birthday, and I know how the situation is right now... but still, ü•Ç cheers to your day! I wish you get all the happiness in the world ‚Äî even mine too. I love you, ü•∫ always.`;

    /*************** Elements ***************/
    const tapCard = document.getElementById('tapCard');
    const stage = document.getElementById('stage');
    const cake = document.getElementById('cake');
    const letter = document.getElementById('letter');
    const typedEl = document.getElementById('typedText');
    const confettiCanvas = document.getElementById('confettiCanvas');
    const heartsContainer = document.getElementById('heartsContainer');

    /* size canvas */
    function sizeCanvas() {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    sizeCanvas(); window.addEventListener('resize', sizeCanvas);

    /*************** Confetti Implementation (simple) ***************/
    const ctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    function spawnConfetti() {
      confettiPieces = [];
      const colors = ["#ff6fb5","#b97bff","#ffd07a","#ff9ad1","#ffd1e8"];
      for(let i=0;i<120;i++){
        confettiPieces.push({
          x: Math.random()*confettiCanvas.width,
          y: Math.random()*-confettiCanvas.height,
          w: 6 + Math.random()*10,
          h: 6 + Math.random()*8,
          vx: -1 + Math.random()*2,
          vy: 2 + Math.random()*4,
          r: Math.random()*360,
          color: colors[Math.floor(Math.random()*colors.length)],
          spin: (Math.random()*6-3)
        });
      }
      runConfetti();
    }
    let confettiRunning = false;
    function runConfetti(){
      confettiRunning = true;
      function frame(){
        ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        for(let p of confettiPieces){
          p.x += p.vx; p.y += p.vy; p.r += p.spin;
          ctx.save();
          ctx.translate(p.x,p.y);
          ctx.rotate(p.r*Math.PI/180);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
          ctx.restore();
        }
        // remove pieces off bottom
        confettiPieces = confettiPieces.filter(p=>p.y < confettiCanvas.height + 40);
        if(confettiPieces.length>0) requestAnimationFrame(frame);
        else { confettiRunning=false; ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
      }
      requestAnimationFrame(frame);
    }

    /*************** Hearts Animation ***************/
    function heartBurst(){
      const num = 14;
      const rect = document.body.getBoundingClientRect();
      for(let i=0;i<num;i++){
        const h = document.createElement('div');
        h.className = 'heart';
        heartsContainer.appendChild(h);
        const startX = 50 + Math.random()*80; // percent
        const startY = 60 + Math.random()*40;
        h.style.left = `${startX}%`;
        h.style.top = `${startY}%`;
        const endX = startX + (Math.random()*40-20);
        const endY = startY - (40 + Math.random()*120);
        h.animate([
          { transform: 'translate(-50%,-50%) scale(.6)', opacity: 0, offset: 0 },
          { transform: `translate(${endX-startX}% , ${endY-startY}%) scale(1)`, opacity: 1, offset: 0.3 },
          { transform: `translate(${endX-startX}%, ${endY-startY}%) scale(.8)`, opacity: 0, offset: 1 }
        ], { duration: 2500 + Math.random()*1000, easing: 'cubic-bezier(.2,.8,.25,1)' });
        setTimeout(()=>{ h.remove(); }, 3500 + Math.random()*1200);
      }
    }

    /*************** Typing animation for letter ***************/
    function typeLetter(text, el, cb) {
      el.textContent = '';
      let i = 0;
      const speed = 28; // ms per char (adjust)
      function step(){
        if(i < text.length){
          el.textContent += text[i++];
          setTimeout(step, speed + Math.random()*20);
        } else if(cb) cb();
      }
      step();
    }

    /*************** Simple WebAudio Happy Birthday melody ***************/
    // notes mapping (approx freq)
    const noteFreq = {
      'C4':261.63,'D4':293.66,'E4':329.63,'F4':349.23,'G4':392.00,'A4':440.00,'B4':493.88,
      'C5':523.25,'D5':587.33,'E5':659.25,'F5':698.46,'G5':783.99
    };
    const melody = [
      ['G4',300],['G4',300],['A4',600], ['G4',600], ['C5',600], ['B4',1200],
      ['G4',300],['G4',300],['A4',600], ['G4',600], ['D5',600], ['C5',1200],
      ['G4',300],['G4',300],['G5',600], ['E5',600], ['C5',600], ['B4',600], ['A4',1200],
      ['F5',300],['F5',300],['E5',600], ['C5',600], ['D5',600], ['C5',1200]
    ];
    let audioContext;
    function playMelody() {
      if(!window.AudioContext && !window.webkitAudioContext) return;
      audioContext = audioContext || new (window.AudioContext || window.webkitAudioContext)();
      const now = audioContext.currentTime;
      let t = now + 0.08;
      const masterGain = audioContext.createGain();
      masterGain.gain.value = 0.12;
      masterGain.connect(audioContext.destination);

      for(let i=0;i<melody.length;i++){
        const [note,dur] = melody[i];
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.type = 'triangle';
        osc.frequency.value = noteFreq[note] || 440;
        gain.gain.value = 0;
        osc.connect(gain); gain.connect(masterGain);
        osc.start(t);
        // envelope
        gain.gain.linearRampToValueAtTime(0.12, t + 0.01);
        gain.gain.linearRampToValueAtTime(0.0001, t + dur/1000 - 0.02);
        osc.stop(t + dur/1000 + 0.02);
        t += dur/1000;
      }
    }

    /*************** Core Interaction ***************/
    let triggered = false;
    tapCard.addEventListener('click', startSurprise);
    tapCard.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') startSurprise(); });

    function startSurprise(){
      if(triggered) return;
      triggered = true;
      // small tap collapse animation
      tapCard.style.transform = 'scale(.96)'; tapCard.style.opacity = '0';
      setTimeout(()=>{ tapCard.style.display = 'none'; }, 300);

      // reveal stage
      setTimeout(()=>{ stage.classList.add('visible'); }, 360);

      // play melody (user tapped -> allowed)
      try { playMelody(); } catch(e){ console.warn('Audio failed',e); }

      // cake animation: pop in & then confetti + hearts + show letter
      // pop-in transform
      cake.style.transform = 'translateY(-12px) scale(.86)'; cake.style.opacity = '0';
      cake.animate([{transform:'translateY(-30px) scale(.7)', opacity:0},{transform:'translateY(0) scale(1.02)', opacity:1},{transform:'translateY(-6px) scale(1)', opacity:1}], {duration:700, easing:'cubic-bezier(.2,.8,.2,1)', fill:'forwards'});
      // after cake appears, trigger confetti and hearts
      setTimeout(()=>{
        spawnConfetti();
        heartBurst();
      }, 720);

      // show typed letter after small delay
      setTimeout(()=>{
        letter.classList.add('visible');
        typeLetter(letterText, typedEl);
      }, 1600);

      // gentle extra heart bursts
      setInterval(()=>{ heartBurst(); }, 2800);
    }

    // small accessibility: allow pressing anywhere on document on mobile to start (first tap)
    document.addEventListener('touchstart', function one(){ document.removeEventListener('touchstart', one); }, {passive:true});
  </script>
</body>
</html>